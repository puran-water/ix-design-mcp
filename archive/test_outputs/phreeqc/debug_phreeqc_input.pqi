DATABASE C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\database\phreeqc.dat
TITLE Direct PHREEQC SAC Simulation - Resolution Independent

PHASES
    Fix_H+
    H+ = H+
    log_k 0.0

# Exchange species will be loaded from the database

SOLUTION 0  # Feed water
    units     mg/L
    temp      25.0
    pH        7.5
    Ca        180.0
    Mg        80.0
    Na        200.0
    Cl        685.8025621006099
    S(6)      0.0 as SO4
    C(4)      300.0 as HCO3

SOLUTION 1-2  # Initial column - Na form resin
    units     mg/L
    temp      25.0
    pH        7.0
    Na        1000
    Cl        1540 charge
    water     157.07963267948966 kg  # CRITICAL: Explicit water for resolution independence

EXCHANGE 1-2
    X         1.4999999999999998  # mol/kg water
    -equilibrate solution 1-2

# Transport with proper dispersivity
TRANSPORT
    -cells    2
    -shifts   10
    -lengths  0.5
    -dispersivities 2*0.002
    -porosities 0.4
    -flow_direction forward
    -boundary_conditions flux flux
    -print_frequency 2
    -punch_frequency 2
    -punch_cells 2

SELECTED_OUTPUT 1
    -file transport.sel
    -reset false
    -step true
    -totals Ca Mg Na
    -molalities CaX2 MgX2 NaX

USER_PUNCH 1
    -headings Step BV Ca_mg_L Mg_mg_L Na_mg_L Ca_pct Mg_pct CaX2_mol NaX_mol
    -start
    10 PUNCH STEP_NO
    # Correct BV calculation
    20 BV = STEP_NO * 157.07963267948966 / 785.3981633974482
    30 PUNCH BV
    # Convert mol/kg to mg/L
    40 ca_mg = TOT("Ca") * 40.078 * 1000
    50 mg_mg = TOT("Mg") * 24.305 * 1000
    60 na_mg = TOT("Na") * 22.990 * 1000
    70 PUNCH ca_mg
    80 PUNCH mg_mg
    90 PUNCH na_mg
    # Calculate percentages
    100 PUNCH ca_mg / 180.0 * 100
    110 PUNCH mg_mg / 80.0 * 100
    # Exchange composition
    120 PUNCH MOL("CaX2")
    130 PUNCH MOL("NaX")
    -end

END


DATABASE C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\database\phreeqc.dat

# Define carboxylic acid surface sites for WAC resin
# Using Wac_ prefix for weak acid cation sites (similar to Hfo_ for hydrous ferric oxide)
SURFACE_MASTER_SPECIES
    Wac_s Wac_sOH

SURFACE_SPECIES
    # Reference species (protonated carboxylic acid)
    Wac_sOH = Wac_sOH
        log_k 0
    
    # Deprotonation reaction (pKa = 4.5)
    Wac_sOH = Wac_sO- + H+
        log_k -4.5
    
    # Additional protonation at very low pH (if needed)
    Wac_sOH + H+ = Wac_sOH2+
        log_k 2.0
    
    # Divalent cation binding (2:1 stoichiometry)
    2Wac_sO- + Ca+2 = (Wac_sO)2Ca
        log_k 11.0  # Adjusted for surface reaction
    
    2Wac_sO- + Mg+2 = (Wac_sO)2Mg
        log_k 10.8  # Adjusted for surface reaction
    
    # Monovalent cation binding
    Wac_sO- + Na+ = Wac_sONa
        log_k 5.0  # Adjusted for surface reaction
    
    Wac_sO- + K+ = Wac_sOK
        log_k 5.2  # Adjusted for surface reaction

# Feed solution
SOLUTION 0 Feed water
    temp      25
    pH        7.2
    units     mg/L
    Ca        160
    Mg        24.3
    Na        100
    K         0
    Cl        350 charge
    Alkalinity 183 as HCO3
    S(6)      200 as SO4
    N(5)      0 as NO3
    water     1 kg

# Initial column solution (acidic to protonate sites)
SOLUTION 1-10 Initial column water
    temp      25
    pH        3.0
    Cl        1 charge
    water     141.3716 kg

# Surface sites distributed across cells

SURFACE 1
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 1

SURFACE 2
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 2

SURFACE 3
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 3

SURFACE 4
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 4

SURFACE 5
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 5

SURFACE 6
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 6

SURFACE 7
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 7

SURFACE 8
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 8

SURFACE 9
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 9

SURFACE 10
    -sites_units absolute
    -no_edl
    Wac_s 1661.1163000000001 1 1
    -equilibrate with solution 10

# Transport simulation
TRANSPORT
    -cells    10
    -shifts   15000
    -time_step 254.46887999999998  # seconds
    -flow_direction forward
    -boundary_conditions flux flux
    -lengths  10*0.353429  # m3
    -dispersivities 10*0.002  # m
    -porosities 10*0.4
    -punch_cells 10
    -punch_frequency 1

# Output for breakthrough curves
SELECTED_OUTPUT 1
    -file transport.sel
    -reset false
    -solution true
    -time true
    -step true
    -pH true
    -alkalinity true
    -totals Ca Mg Na K Cl C(4) S(6)
    -molalities H+ OH- CO2 HCO3- CO3-2 Wac_sOH Wac_sO- (Wac_sO)2Ca (Wac_sO)2Mg Wac_sONa Wac_sOK
    -saturation_indices Calcite Aragonite Dolomite

USER_PUNCH 1
    -headings BV Cell Ca_mg/L Mg_mg/L Na_mg/L Hardness_mg/L pH Alk_mg/L CO2_mg/L Active_Sites_% Ca_Removal_%
    -start
    10 REM BV calculation: volume passed / total bed volume
    20 BV = STEP_NO * 141.3716 / 3534.29
    30 IF (STEP_NO <= 0) THEN GOTO 300
    40 PUNCH BV, CELL_NO
    50 ca_mg = TOT("Ca") * 40.078 * 1000
    60 mg_mg = TOT("Mg") * 24.305 * 1000
    70 na_mg = TOT("Na") * 22.990 * 1000
    80 PUNCH ca_mg
    90 PUNCH mg_mg
    100 PUNCH na_mg
    110 hardness_caco3 = ca_mg * 2.5 + mg_mg * 4.1
    120 PUNCH hardness_caco3
    130 PUNCH -LA("H+")
    140 alk_mg = ALK * 61000
    145 IF (alk_mg < 0) THEN alk_mg = 0
    150 PUNCH alk_mg
    160 co2_mg = MOL("CO2") * 44010 * 1000
    170 PUNCH co2_mg
    # Calculate active sites percentage based on Wac_sO- fraction
    180 wac_so_mol = MOL("Wac_sO-")
    185 wac_soh_mol = MOL("Wac_sOH")
    190 total_sites = wac_so_mol + wac_soh_mol + 2*MOL("(Wac_sO)2Ca") + 2*MOL("(Wac_sO)2Mg") + MOL("Wac_sONa") + MOL("Wac_sOK")
    195 IF (total_sites > 0) THEN active_percent = (wac_so_mol / total_sites) * 100 ELSE active_percent = 0
    200 PUNCH active_percent
    # Calculate Ca removal
    220 feed_ca = 160
    230 IF (feed_ca > 0) THEN ca_removal = (1 - ca_mg/feed_ca) * 100 ELSE ca_removal = 0
    240 IF (ca_removal < 0) THEN ca_removal = 0
    250 PUNCH ca_removal
    300 REM end
    -end

END

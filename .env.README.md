# Environment Configuration for IX Design MCP Server

## Quick Setup

1. **Determine your environment:**
   - Running on Windows? Use `.env.windows`
   - Running on WSL/Linux? Use `.env.wsl`

2. **Copy the appropriate file:**
   ```bash
   # For Windows:
   copy .env.windows .env
   
   # For WSL/Linux:
   cp .env.wsl .env
   ```

3. **Verify PHREEQC paths:**
   - Check that the paths in your `.env` file match your actual PHREEQC installation
   - Update if necessary

## Environment Variables

### Required Variables

- **PHREEQC_EXE**: Full path to PHREEQC executable
  - Windows: Usually a `.bat` file like `C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\bin\phreeqc.bat`
  - Linux/WSL: Usually `/usr/bin/phreeqc` or `/home/user/phreeqc/bin/phreeqc`

- **PHREEQC_DATABASE**: Full path to PHREEQC database file
  - Windows: Usually `C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\database\phreeqc.dat`
  - Linux/WSL: Usually `/usr/share/phreeqc/database/phreeqc.dat`

### Timeout Configuration

- **PHREEQC_RUN_TIMEOUT_S**: Timeout for individual PHREEQC subprocess calls (default: 90 seconds)
- **MCP_SIMULATION_TIMEOUT_S**: Overall simulation timeout (default: 100 seconds)

### Important Notes

1. **OS Compatibility**: The server now validates that paths match the operating system. Windows paths won't work on Linux and vice versa.

2. **Timeout Hierarchy**: 
   - PHREEQC_RUN_TIMEOUT_S < MCP_SIMULATION_TIMEOUT_S < Client timeout (~120s)
   - This prevents cascade failures and broken pipe errors

3. **Path Validation**: The server will reject incompatible paths and provide clear error messages

## Troubleshooting

If you see errors like:
- "PHREEQC executable not found for nt platform" - Check Windows paths in .env
- "PHREEQC executable not found for posix platform" - Check Linux paths in .env
- "Rejecting POSIX path on Windows" - You're using Linux paths on Windows
- "Rejecting Windows path on Unix" - You're using Windows paths on Linux

## Example Configurations

### Windows with standard USGS installation:
```env
PHREEQC_EXE=C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\bin\phreeqc.bat
PHREEQC_DATABASE=C:\Program Files\USGS\phreeqc-3.8.6-17100-x64\database\phreeqc.dat
```

### WSL with custom installation:
```env
PHREEQC_EXE=/home/hvksh/process/phreeqc/bin/phreeqc
PHREEQC_DATABASE=/home/hvksh/process/phreeqc/share/doc/phreeqc/database/phreeqc.dat
```

### Linux with system-wide installation:
```env
PHREEQC_EXE=/usr/bin/phreeqc
PHREEQC_DATABASE=/usr/share/phreeqc/database/phreeqc.dat
```